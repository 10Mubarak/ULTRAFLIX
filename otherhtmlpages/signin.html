<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In</title>
    <link rel="stylesheet" href="../othercsspages/signin.css">
    <link rel="shortcut icon" href="../images/ultraflix-plus-logo.jpeg" type="image/x-icon">
</head>

<body>

    <section class="signin-hero">

        <div class="signin-overlay"></div>

        <div class="signin-card">
            <h2>Welcome Back</h2>

            <form class="signin-form" id="signin-form">

                <div class="input-line">
                    <input id="signin-email" type="email" required>
                    <label>Email</label>
                </div>

                <div class="input-line">
                    <input id="signin-password" type="password" required>
                    <label>Password</label>
                </div>

                <button class="signin-btn" id="signin-btn">Sign In</button>

                <!-- <p class="forgot">
                <a href="#" id="forgot-password">Forgot Password?</a>
            </p> -->

                <p class="signup-link">
                    Donâ€™t have an account? <a href="./signup.html">Create one</a>
                </p>

            </form>

        </div>

    </section>


    <!-- ========== FIREBASE AUTH SCRIPT ========== -->
    <script type="module">
        // Import Firebase
        import {
            initializeApp
        } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";

        import {
            getAuth,
            signInWithEmailAndPassword,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

        // Your Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDTJUU0Vyu7tpspEYYSRtO_Tu0uiIqu5_k",
            authDomain: "ultraflix-59234.firebaseapp.com",
            projectId: "ultraflix-59234",
            storageBucket: "ultraflix-59234.firebasestorage.app",
            messagingSenderId: "971160548494",
            appId: "1:971160548494:web:3125aa3da77d26c90cc5df"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // ========== SIGN IN FUNCTION ==========
        document.getElementById("signin-form").addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("signin-email").value;
            const password = document.getElementById("signin-password").value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                const username = user.displayName || email.split('@')[0]; // Use displayName or email prefix
                localStorage.setItem('welcomeUsername', username);

                // Redirect to home page
                window.location.href = "../otherhtmlpages/dashboard.html";
            } catch (error) {
                alert(error.message);
            }
        });

        // ========== FORGOT PASSWORD FUNCTION ==========
        // document.getElementById("forgot-password").addEventListener("click", async () => {
        //     const email = prompt("Enter your email to reset your password:");

        //     if (!email) return;

        //     try {
        //         await sendPasswordResetEmail(auth, email);
        //         alert("Password reset link sent! Check your email inbox.");
        //     } catch (error) {
        //         alert(error.message);
        //     }
        // });
    </script>

</body>

</html>